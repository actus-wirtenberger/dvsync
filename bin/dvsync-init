#!/bin/sh

function stop() {
	kill -15 1
	sleep 5s
	kill -9 -1
}

if [ -z ${NGROK_AUTHTOKEN} ]; then
  echo "⛔️  Please provide \$NGROK_AUTHTOKEN. You can find it at https://dashboard.ngrok.com/auth"
  stop
fi

echo "🚀  Starting dvsync server..."

echo "🔑  Generating server RSA key..."
ssh-keygen -f ~/.ssh/id_rsa -N '' -q

echo "🔑  Generating client RSA key..."
ssh-keygen -f ~/.ssh/client_rsa -N '' -q
cp ~/.ssh/client_rsa.pub ~/.ssh/authorized_keys

ngrok authtoken ${NGROK_AUTHTOKEN} > /dev/null
